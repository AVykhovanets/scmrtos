<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>scmRTOS v3 ADSP-BF533/VisualDSP++ Release Notes</title>
<meta name="author" content="Harry E.Zhurov" />
<meta name="date" content="$Date $" />
<style type="text/css">

body {
	color: Black;
/*	background-color: #E6EEFC; */
	background-color: #F1F6FE;
	font-family: "Trebuchet MS", Garamond, Tahoma, "Courier New", Courier, sans-serif;
	font-size: medium;
}

pre {
	background-color: #D4D8DE;
}

li {
	font-family: sans-serif;
	font-size: small;
	font-weight: normal;
	color: Black;
}



tr {
	text-align: left;
}


h1.title {
   text-align: center;
   background-color: #123676;
	color: #D2C01A;
	font-family: Tahoma, sans-serif;
	font-weight: bold;
	font-size: 24px;
  }


h1 {
	background-color: #AEC8F6;
	border: none;
	font-family: Verdana, Tahoma, sans-serif;
	font-weight: bold;
	font-size: 20px;
}
	
	
h2 {
	font-family: Verdana, Tahoma, sans-serif;
	font-size: 16px;
}

a {
	color: #232791;
}

A:visited {
	color: #DBA083; /* #4169E1;	*/
}

p {
	font-family: "Trebuchet MS", Garamond, System, Verdana, Tahoma, sans-serif;
	font-size: medium;
	font-weight: normal;
	color: Black;
}

.contents {
	font-family: Arial, sans-serif;
	font-weight: bolder;
	font-size: medium;
}






</style>
</head>
<body>
<div class="document" id="scmrtos-v3-adsp-bf533-visualdsp-release-notes">
<h1 class="title">scmRTOS v3 ADSP-BF533/VisualDSP++ Release Notes</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Harry E.Zhurov</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>$Date $</td></tr>
<tr><th class="docinfo-name">Revision:</th>
<td>$Rev $</td></tr>
<tr class="field"><th class="docinfo-name">Info:</th><td class="field-body">See main scmRTOS User's Manual for details</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">contents</a></p>
<ul class="simple">
<li><a class="reference" href="#preamble" id="id7" name="id7">Preamble</a></li>
<li><a class="reference" href="#general-description" id="id8" name="id8">General Description</a></li>
<li><a class="reference" href="#sample-structure" id="id9" name="id9">Sample Structure</a></li>
<li><a class="reference" href="#usage" id="id10" name="id10">Usage</a><ul>
<li><a class="reference" href="#working-with-repository" id="id11" name="id11">Working with Repository</a></li>
<li><a class="reference" href="#working-with-release" id="id12" name="id12">Working with Release</a></li>
<li><a class="reference" href="#standalone-rtos-sources" id="id13" name="id13">Standalone RTOS sources</a></li>
</ul>
</li>
<li><a class="reference" href="#building" id="id14" name="id14">Building</a><ul>
<li><a class="reference" href="#assembler" id="id15" name="id15">Assembler:</a></li>
<li><a class="reference" href="#compiler" id="id16" name="id16">Compiler:</a></li>
<li><a class="reference" href="#linker" id="id17" name="id17">Linker:</a></li>
</ul>
</li>
<li><a class="reference" href="#utilities" id="id18" name="id18">Utilities</a><ul>
<li><a class="reference" href="#vdsp-lst-py" id="id19" name="id19">vdsp_lst.py</a></li>
<li><a class="reference" href="#get-info-py" id="id20" name="id20">get_info.py</a></li>
<li><a class="reference" href="#ldprg-py" id="id21" name="id21">ldprg.py</a></li>
<li><a class="reference" href="#utils-py" id="id22" name="id22">utils.py</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id7" id="preamble" name="preamble">Preamble</a></h1>
<p>Release includes a sample set that contains three samples and RTOS sources.
The purpose of the sample set is to show use examples and primary RTOS
functionality and features.</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id8" id="general-description" name="general-description">General Description</a></h1>
<p>RTOS consists of three parts:</p>
<ul class="simple">
<li>Common part;</li>
<li>Target-dependent part;</li>
<li>Project-dependent part.</li>
</ul>
<p>Common part contains main RTOS definitions and declarations such as RTOS kernel,
interprocess communication services and little support library. All Common sources
stand at <tt class="docutils literal"><span class="pre">Common</span></tt> subfolder (see below).</p>
<p>Target-dependent part describes target processor and toolkit features of the RTOS:</p>
<ul class="simple">
<li>Target-level configuration macros;</li>
<li>Critical section definition;</li>
<li>Some performance-critical finctions;</li>
<li>Interrupt and interrupt service routines support;</li>
<li>Target processor specific process's constructor;</li>
<li>Idle process declaration.</li>
</ul>
<p>Project-dependent part includes two header files:</p>
<ul class="simple">
<li>scmRTOS_CONFIG.h;</li>
<li>scmRTOS_TARGET_CFG.h.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">scmRTOS_CONFIG.h</span></tt> describes project-level RTOS configuration macros.</p>
<p><tt class="docutils literal"><span class="pre">scmRTOS_TARGET_CFG.h</span></tt> contains project-level tuning code, in particular
System Timer and context switch software interrupt stuff. Default, WatchDog Timer
is used as System Timer, and Analog Comparator Interrupt as Software Context
Switch Interrupt. The user can change these setting to more project-suitable if
need.</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id9" id="sample-structure" name="sample-structure">Sample Structure</a></h1>
<p>The sample consists of three parts:</p>
<blockquote>
<ul class="simple">
<li>EventFlag;</li>
<li>message;</li>
<li>channel.</li>
</ul>
</blockquote>
<p><tt class="docutils literal"><span class="pre">EventFlag</span></tt> sample brings test on speed. <tt class="docutils literal"><span class="pre">OS::TEventFlag</span></tt> is the simplest and
fastest   service   of   the   RTOS.   In  this  example  program  control  flow
transferred  from   timer   interrupt   service   routine   (ISR)   to   waiting
process.  Dedicated  processor's   pin   is  set  to '1' before signaling of the
<tt class="docutils literal"><span class="pre">EventFlag</span></tt>  and set to '0' inside  waiting  process.  So, positive pulse width on
this pin corresponds with program control flow transfer time.</p>
<p><tt class="docutils literal"><span class="pre">OS::message</span></tt>  sample demonstrates ability to send arbitrary information from ISRs
and  processes  to  processes.  In the example one process waits the message and
timer  ISR and another process send the message. Message content is different in
each case, so, process-receiver can distinguish the source of the message.</p>
<p>Sample with <tt class="docutils literal"><span class="pre">OS::channel</span></tt> showes a message  queue. Since the message can have
arbitrary type, current example uses pointers to class types. In the example two
more  priority  processes  &quot;delegate&quot;  some  actions to the third (low-priority)
process. See scmRTOS User's Manual Appendix section for more details about this
mechanism.</p>
<p>Contents  of  all parts is the same: test project and RTOS sources. Each located
in its own folder.</p>
<p>Structure of test project folder (folders are in brackets '[]'):</p>
<pre class="literal-block">
[Config]          - linker scripts and other utilites
[Exe]             - executable product[s]
[List]            - listings and other temporary text files
[Obj]             - objects and other intermediate files
[settings]        - IAR IDE auxiliary files
[Src]             - test project sources
slon.vpj          - SlickEdit project file
slon.Blackfin.vpw - SlickEdit workspace file
SConstruct        - Scons main script file
</pre>
<p><strong>slon</strong> is test project name.</p>
<p>Structure of the RTOS folder:</p>
<pre class="literal-block">
scmRTOS
  Common            - common RTOS sources
  BF533             - potrable part
</pre>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id10" id="usage" name="usage">Usage</a></h1>
<p>There are two variants of usage. The first variant is checking out sample set from the
<a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">SourceForge repository</a>. The second one is downloading the release archive and using it locally.</p>
<div class="section">
<h2><a class="toc-backref" href="#id11" id="working-with-repository" name="working-with-repository">Working with Repository</a></h2>
<p>Initially, after checkout from repository the folders</p>
<div class="line-block">
<div class="line">scmRTOS/Common</div>
<div class="line">scmRTOS/BF533</div>
</div>
<p>are  empty. User has to switch these folders manually to appropriate repository
folders:</p>
<div class="line-block">
<div class="line">scmRTOS/Common to $REP$/Common</div>
<div class="line">scmRTOS/BF533 to $REP$/Ports/BF533/VDSP_XXX</div>
</div>
<p>where <tt class="docutils literal"><span class="pre">$REP$</span></tt> is proper branch of the repository and XXX is corresponding version
name of toolkit.</p>
<p>After this working copy is ready to build.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id12" id="working-with-release" name="working-with-release">Working with Release</a></h2>
<p>In  this  case  no  extra  actions  required. User can build the samples at this
point.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id13" id="standalone-rtos-sources" name="standalone-rtos-sources">Standalone RTOS sources</a></h2>
<p>There is one more way to usage RTOS (RTOS only, not the whole release). To do this
the user has to create local folders for RTOS sources - for Common part and for Port
part as well. For example, create at user's project folder subfolder <tt class="docutils literal"><span class="pre">scmRTOS</span></tt> (or
with any other suitable name); inside this subfolder create subfolders for Common
and Port sources; set to this subfolders <tt class="docutils literal"><span class="pre">svn:externals</span></tt> <a class="footnote-reference" href="#id4" id="id1" name="id1">[1]</a> properties that will link
these subfolders to the appropriate folders in <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">external (SourceForge) repository</a>.</p>
<p>In this way, user gets the ability to synchronize its project RTOS sources with <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">main
RTOS repository</a>.</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id14" id="building" name="building">Building</a></h1>
<p>There are several ways to build any sample.</p>
<p>The simplest way is to employ <a class="reference" href="http://www.scons.org">SCons</a>  build system. Scons
is  actually <a class="reference" href="http://www.python.org">Python</a> script, so Python interpreter is necessary  to
use  <a class="reference" href="http://www.scons.org">SCons</a>.  <a class="reference" href="http://www.scons.org">SCons</a>, in a certain sense, is the analog  of popular build  utility make,
but much more powerful because of comprehensive underground of programming language (<a class="reference" href="http://www.python.org">Python</a>).</p>
<p>To use <a class="reference" href="http://www.scons.org">SCons</a>:</p>
<ul class="simple">
<li>download and install <a class="reference" href="http://www.python.org">Python</a> interpreter v2.4;</li>
<li>download and install <a class="reference" href="http://www.scons.org">SCons</a> tool;</li>
<li>launch <a class="reference" href="http://www.scons.org">SCons</a> by typing tool name in command line in folder
where SConstruct file (SCons main script) located <a class="footnote-reference" href="#id5" id="id2" name="id2">[2]</a>.</li>
</ul>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">$PROMPT$&gt;scons</span></tt></div>
</div>
<p>SCons will build the project.</p>
<p>If  user want to use his own build system <a class="footnote-reference" href="#id6" id="id3" name="id3">[3]</a> he has to specify the following
command-line options for various tools:</p>
<div class="section">
<h2><a class="toc-backref" href="#id15" id="assembler" name="assembler">Assembler:</a></h2>
<pre class="literal-block">
-proc ADSP-BF533
-g
-o Obj\&lt;src_name&gt;.doj
-ISrc
-I../scmRTOS/Common
-I../scmRTOS/BF533
-I$TOOLKIT_PATH$\Blackfin\include
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id16" id="compiler" name="compiler">Compiler:</a></h2>
<pre class="literal-block">
-proc ADSP-BF533
-si-revision 0.3
-C
-c
-g
-c++
-Ov 80
-instantlocal
-Wsuppress cc1164
-path-output Obj
-save-temps
-ISrc
-I../scmRTOS/Common
-I../scmRTOS/BF533
-I$TOOLKIT_PATH$\Blackfin\include
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id17" id="linker" name="linker">Linker:</a></h2>
<pre class="literal-block">
-proc ADSP-BF533
-si-revision 0.3
-e
-save-temps
-L Obj
-Map List\slon.xml
-o Exe\slon.dxe
-T Config\BF533cpp.ldf
-Map Config\BF533cpp.ldf
-L$TOOLKIT_PATH$\Blackfin\lib532_rev_0.3
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">where $TOOLKIT_PATH$ - path to folder with toolkit installed.</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id18" id="utilities" name="utilities">Utilities</a></h1>
<p>Additionally,  folder  Config contains some useful script utilites that user may
take  into  account.  All  utilites  are  Python scripts. This means that Python
interpreter must be installed. The utilites are:</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">vdsp_lst.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">get_info.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ldprg.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">utils.py</span></tt></li>
</ul>
</blockquote>
<div class="section">
<h2><a class="toc-backref" href="#id19" id="vdsp-lst-py" name="vdsp-lst-py">vdsp_lst.py</a></h2>
<p>Some  compilers  produces auxillary list files, in which source code interleaved
with  assebler  mnemonics.  This  is convenient thing to inspect codegeneration.
Unfortunately,  <tt class="docutils literal"><span class="pre">VisualDSP++</span></tt>  Blackfin  compiler  does  not generate such listing
file.  As  maximum,  the  compiler  can  generate  auxillary assembler file that
contains assembler code with text links to source code, for example:</p>
<pre class="literal-block">
.LN17:
// &quot;Src\main.cpp&quot; line 125 col 5
       P0.L =  1544;
       P0.H =  -64;
       R0 =  10011 (X);
       [P0+ 0] = R0;
.LN18:
// &quot;Src\main.cpp&quot; line 126 col 5
       P1.L =  1548;
       P1.H =  -64;
       R0 =  5000 (X);
       [P1+ 0] = R0;
</pre>
<p><strong>vdsp_lst.py</strong>  just  performs source code insertion on base of links, so the above
example looks like the following:</p>
<pre class="literal-block">
.LN17:
    MMR32(TIMER0_PERIOD) = 10011; // &quot;Src\main.cpp&quot; line 125 col 5
       P0.L =  1544;
       P0.H =  -64;
       R0 =  10011 (X);
       [P0+ 0] = R0;
.LN18:
    MMR32(TIMER0_WIDTH)  = 5000; // &quot;Src\main.cpp&quot; line 126 col 5
       P1.L =  1548;
       P1.H =  -64;
       R0 =  5000 (X);
       [P1+ 0] = R0;
</pre>
<p>The  using  of  <strong>vdsp_lst.py</strong>  is  very  simple:  just launch the utility with one
argument  - compiler generated .s file (to enable generating of .s files command
line option <tt class="docutils literal"><span class="pre">-save-temps</span></tt> must be specified).</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id20" id="get-info-py" name="get-info-py">get_info.py</a></h2>
<p><tt class="docutils literal"><span class="pre">VisualDSP++</span></tt>  linker  does not issue any explicit info about code and data sizes of
linked project. To get this info the user has to launch elfdump.exe utility from
<tt class="docutils literal"><span class="pre">VisualDSP++</span></tt>  toolkit.  Unfortunately, elfdump outputs information in uncomfortable
format  (a  lot  of service info, hexadecimal representation of sizes, etc.). To
fix  this  inconvenience  get_info.py  can be used. The utility gets output from
elfdump and produces info in human-readable format. See the example below:</p>
<pre class="literal-block">
Total :  Code: 2394 bytes
         Data: 3436 bytes (Segment A: 3416 bytes. Segment B: 20 bytes.)

----------------------------------
Details | Section     | Size
----------------------------------
        |  code       | 2394 bytes
        |  data_a     |  228 bytes
        |  data_b     |   20 bytes
        |  bsz_data_a | 3188 bytes
        |  bsz_data_b |    0 bytes
----------------------------------
</pre>
<p><strong>get_info.py</strong> is used in the following manner:</p>
<p><tt class="docutils literal"><span class="pre">get_info.py</span> <span class="pre">dump.txt</span></tt></p>
<p>where <tt class="docutils literal"><span class="pre">dump.txt</span></tt>  - text file with dump from elfdump.exe. dump.txt can be created
by simple redirect elfdump output to file.</p>
</div>
<hr class="docutils" />
<div class="section">
<h2><a class="toc-backref" href="#id21" id="ldprg-py" name="ldprg-py">ldprg.py</a></h2>
<p><strong>ldprg.py</strong>  is  a  custom  user  loader.  This  utility allow to customize loading
process  by  launch service executable (.dxe) before loading of main executable.
This  can  be  useful, for example, in case when the user's program stores data
objects  in  SDRAM  -  these  objects  must  be  initialized (according to C/C++
Standard) and initializing is performed during loading the user's program. So, if
at  this  moment  processor's  SDRAM  controller is not properly initialized the
initializing  process  will  fail  and processor will not start properly. Custom
loader fixes this situation. The loader allows to run a special service executable
before  loading  main  user  executable.  This service executable performs SDRAM
controller setup (and other actions if need).</p>
<p>The using of custom user loader is the following:</p>
<pre class="literal-block">
ldprg.py -p &lt;ProcessorName&gt; -i &lt;Initializer FileName&gt; -e &lt;Executable FileName&gt; -s &lt;Session Name&gt;

where
    &lt;ProcessorName&gt; is name of the used processor. Available Processors are: ADSP-BF531, ADSP-BF532, ADSP-BF533
    &lt;Initializer FileName&gt; is name of service executable (.dxe file)
    &lt;Executable FileName&gt; is name of main executable (.dxe file)
    &lt;Session Name&gt; is name of debug session. Only emulator sessions are suitable.
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id22" id="utils-py" name="utils-py">utils.py</a></h2>
<p><tt class="docutils literal"><span class="pre">VisualDSP++</span></tt>  compiler  performs error message line wrapping, so error message
often occupies several (two or more) lines. Some powerful 3rd party programmer's
editors  uses  status  line  to show error message text when error locator opens
source  file  with error. At that moment the only first line of error message is
diaplayed in status line. This is very inconvenient.</p>
<p><strong>utils.py</strong>   contains   function   <tt class="docutils literal"><span class="pre">handle_err()</span></tt>   that  performs  error  message
unwrapping. The using of the function is very simple:</p>
<pre class="literal-block">
oerr = utils.handle_err(out)

  where out  - compiler's stderr stream,
        oerr - the same stream with error/warning lines unwrapped.
</pre>
<p>This function cannot be used standalone - it can be used only inside Python srcipt.</p>
<hr class="docutils" />
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">When using <a class="reference" href="http://www.scons.org">Scons</a> to build the project the above utilities (except <tt class="docutils literal"><span class="pre">ldprg.py</span></tt>)
are run automatically.</p>
</div>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="id4">[1]</a></td><td>For more details about <tt class="docutils literal"><span class="pre">svn:externals</span></tt> see <a class="reference" href="http://subversion.tigris.org">Subversion</a> documentation.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2" name="id5">[2]</a></td><td>SConstruct file contains variable <tt class="docutils literal"><span class="pre">TOOLKIT_PATH</span></tt> that specifies path to toolkit on particular PC.
The user should correct this path according to his PC toolkit location. The path can be specified
directly or through system enviroinment variables as well.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3" name="id6">[3]</a></td><td>For example, make or simple bat file.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
