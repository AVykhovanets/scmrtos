<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>scmRTOS v3 AT91SAM7/EWARM Release Notes</title>
<meta name="author" content="Harry E.Zhurov, Sergey A. Borshch" />
<meta name="date" content="$Date $" />
<style type="text/css">

body {
	color: Black;
/*	background-color: #E6EEFC; */
	background-color: #F1F6FE;
	font-family: "Trebuchet MS", Garamond, Tahoma, "Courier New", Courier, sans-serif;
	font-size: medium;
}

pre {
	background-color: #D4D8DE;
}

li {
	font-family: sans-serif;
	font-size: small;
	font-weight: normal;
	color: Black;
}



tr {
	text-align: left;
}


h1.title {
   text-align: center;
   background-color: #123676;
	color: #D2C01A;
	font-family: Tahoma, sans-serif;
	font-weight: bold;
	font-size: 24px;
  }


h1 {
	background-color: #AEC8F6;
	border: none;
	font-family: Verdana, Tahoma, sans-serif;
	font-weight: bold;
	font-size: 20px;
}
	
	
h2 {
	font-family: Verdana, Tahoma, sans-serif;
	font-size: 16px;
}

a {
	color: #232791;
}

A:visited {
	color: #DBA083; /* #4169E1;	*/
}

p {
	font-family: "Trebuchet MS", Garamond, System, Verdana, Tahoma, sans-serif;
	font-size: medium;
	font-weight: normal;
	color: Black;
}

.contents {
	font-family: Arial, sans-serif;
	font-weight: bolder;
	font-size: medium;
}






</style>
</head>
<body>
<div class="document" id="scmrtos-v3-at91sam7-ewarm-release-notes">
<h1 class="title">scmRTOS v3 AT91SAM7/EWARM Release Notes</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Harry E.Zhurov, Sergey A. Borshch</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>$Date $</td></tr>
<tr><th class="docinfo-name">Revision:</th>
<td>$Rev $</td></tr>
<tr class="field"><th class="docinfo-name">Info:</th><td class="field-body">See main scmRTOS User's Manual for details</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">contents</a></p>
<ul class="simple">
<li><a class="reference" href="#preamble" id="id5" name="id5">Preamble</a></li>
<li><a class="reference" href="#general-description" id="id6" name="id6">General Description</a></li>
<li><a class="reference" href="#sample-structure" id="id7" name="id7">Sample Structure</a></li>
<li><a class="reference" href="#usage" id="id8" name="id8">Usage</a><ul>
<li><a class="reference" href="#working-with-repository" id="id9" name="id9">Working with Repository</a></li>
<li><a class="reference" href="#working-with-release" id="id10" name="id10">Working with Release</a></li>
<li><a class="reference" href="#standalone-rtos-sources" id="id11" name="id11">Standalone RTOS sources</a></li>
</ul>
</li>
<li><a class="reference" href="#building" id="id12" name="id12">Building</a><ul>
<li><a class="reference" href="#assembler" id="id13" name="id13">Assembler:</a></li>
<li><a class="reference" href="#compiler" id="id14" name="id14">Compiler:</a></li>
<li><a class="reference" href="#linker" id="id15" name="id15">Linker:</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id5" id="preamble" name="preamble">Preamble</a></h1>
<p>Release includes a sample set that contains three samples and RTOS sources.
The purpose of the sample set is to show use examples and primary RTOS
functionality and features. Each sample EW project has two targets: RAM and FLASH
to run sample from RAM or ROM memory respectivly using J-Link debugger.</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id6" id="general-description" name="general-description">General Description</a></h1>
<p>RTOS consists of three parts:</p>
<ul class="simple">
<li>Common part;</li>
<li>Target-dependent part;</li>
<li>Project-dependent part.</li>
</ul>
<p>Common part contains main RTOS definitions and declarations such as RTOS kernel,
interprocess communication services and little support library. All Common sources
stand at <tt class="docutils literal"><span class="pre">Common</span></tt> subfolder (see below).</p>
<p>Target-dependent part describes target processor and toolkit features of the RTOS:</p>
<ul class="simple">
<li>Target-level configuration macros;</li>
<li>Critical section definition;</li>
<li>Some performance-critical functions;</li>
<li>Interrupt and interrupt service routines support;</li>
<li>Target processor specific process's constructor;</li>
<li>Idle process declaration.</li>
</ul>
<p>Project-dependent part includes two header files:</p>
<ul class="simple">
<li>scmRTOS_CONFIG.h;</li>
<li>scmRTOS_TARGET_CFG.h.</li>
<li>device.h.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">scmRTOS_CONFIG.h</span></tt> describes project-level RTOS configuration macros.</p>
<p><tt class="docutils literal"><span class="pre">scmRTOS_TARGET_CFG.h</span></tt> contains project-level tuning code, in particular
System Timer and context switch software interrupt stuff. By default, Periodic
Interval Timer (PIT) is used as System Timer, and USB Device Port (UDP) Interrupt
as Software Context Switch Interrupt. The user can change these settings to be more
project-suitable if need.</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id7" id="sample-structure" name="sample-structure">Sample Structure</a></h1>
<p>The sample consists of three parts:</p>
<blockquote>
<ul class="simple">
<li>EventFlag;</li>
<li>message;</li>
<li>channel.</li>
</ul>
</blockquote>
<p><tt class="docutils literal"><span class="pre">EventFlag</span></tt> sample brings test on speed. <tt class="docutils literal"><span class="pre">OS::TEventFlag</span></tt>  is the simplest and
fastest   service   of   the   RTOS.   In  this  example  program  control  flow
transferred  from   timer   interrupt   service   routine   (ISR)   to   waiting
process.  Dedicated  processor's   pin   is  set  to '1' before signaling of the
<tt class="docutils literal"><span class="pre">EventFlag</span></tt>  and set to '0' inside  waiting  process.  So, positive pulse width on
this pin corresponds with program control flow transfer time.</p>
<p><tt class="docutils literal"><span class="pre">OS::message</span></tt> sample demonstrates ability to send arbitrary information from ISRs
and  processes  to  processes.  In the example one process waits the message and
timer  ISR and another process send the message. Message content is different in
each case, so, process-receiver can distinguish the source of the message.</p>
<p>Sample  with  <tt class="docutils literal"><span class="pre">OS::channel</span></tt>  showes  a  message  queue. Since the message can have
arbitrary type, current example uses pointers to class types. In the example two
more  priority  processes  &quot;delegate&quot;  some  actions to the third (low-priority)
process. See scmRTOS User's Manual Appendix section for more details about this
mechanism.</p>
<p>Contents  of  all parts is the same: test project and RTOS sources. Each located
in its own folder.</p>
<p>Structure of test project folder (folders are in brackets '[]'):</p>
<pre class="literal-block">
[Config]          - linker scripts and C-Spy startup macros
[Exe]             - executable product[s]
[List]            - listings and other temporary text files
[Obj]             - objects and other intermediate files
[settings]        - IAR IDE auxiliary files
[Src]             - test project sources
slon.ewd          - IAR C-Spy project setings
slon.ewp          - IAR IDE project
slon.eww          - IAR IDE workspace
</pre>
<p><strong>slon</strong> is test project name.
Linker scripts are suitable to test example on any AT91SAM7 device.
If you want to use this script in your own scmRTOS-baset project you have to adjust RAMEND
and ROMEND definitions to fit your chip memory sizes.</p>
<p>Structure of the RTOS folder:</p>
<pre class="literal-block">
scmRTOS
  Common            - common RTOS sources
  ARM7              - potrable part
</pre>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id8" id="usage" name="usage">Usage</a></h1>
<p>There are two variants of usage. The first variant is checking out sample set from the
<a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">SourceForge repository</a>. The second one is downloading the release archive and using it locally.</p>
<div class="section">
<h2><a class="toc-backref" href="#id9" id="working-with-repository" name="working-with-repository">Working with Repository</a></h2>
<p>Initially, after checkout from repository the folders</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/Common</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/ARM7</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">2-Message/Config</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">3-Channel/Config</span></tt></div>
</div>
<p>and files</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">2-Message/Src/device.h</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">3-Channel/Src/device.h</span></tt></div>
</div>
<p>are  empty. User has to switch these folders manually to appropriate repository
folders and files:</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/Common</span> <span class="pre">to</span> <span class="pre">$REP$/Common</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/ARM7</span> <span class="pre">to</span> <span class="pre">$REP$/Ports/ARM7/IAR_vX.XX</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">2-Message/Config</span> <span class="pre">to</span> <span class="pre">$REP$/Examples/ARM7/IAR_vX.XX/AT91SAM7/1-EventFlag/Config</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">3-Channel/Config</span> <span class="pre">to</span> <span class="pre">$REP$/Examples/ARM7/IAR_vX.XX/AT91SAM7/1-EventFlag/Config</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">2-Message/Src/device.h</span> <span class="pre">to</span> <span class="pre">$REP$/Examples/ARM7/IAR_vX.XX/AT91SAM7/1-EventFlag/Src/device.h</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">3-Channel/Src/device.h</span> <span class="pre">to</span> <span class="pre">$REP$/Examples/ARM7/IAR_vX.XX/AT91SAM7/1-EventFlag/Src/device.h</span></tt></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">$REP$</span></tt> is proper branch of the repository and XXX is corresponding version
name of toolkit.</p>
<p>After this working copy is ready to build.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id10" id="working-with-release" name="working-with-release">Working with Release</a></h2>
<p>In  this  case  no  extra  actions  required. User can build the samples at this
point.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id11" id="standalone-rtos-sources" name="standalone-rtos-sources">Standalone RTOS sources</a></h2>
<p>There is one more way to usage RTOS (RTOS only, not the whole release). To do this
the user has to create local folders for RTOS sources - for Common part and for Port
part as well. For example, create at user's project folder subfolder <tt class="docutils literal"><span class="pre">scmRTOS</span></tt> (or
with any other suitable name); inside this subfolder create subfolders for Common
and Port sources; set to this subfolders <tt class="docutils literal"><span class="pre">svn:externals</span></tt> <a class="footnote-reference" href="#id3" id="id1" name="id1">[1]</a> properties that will link
these subfolders to the appropriate folders in <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">external (SourceForge) repository</a>.</p>
<p>In this way, user gets the ability to synchronize its project RTOS sources with <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">main
RTOS repository</a>.</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id12" id="building" name="building">Building</a></h1>
<p>There is only one way to build any sample provided - <strong>IAR IDE</strong>.</p>
<p>Just launch IDE, open appropriate workspace (*.eww file), choose project target (RAM/Flash),
and build the project.
Default chip type the sample project is targeted for is AT91SAM7S64. To alter chip type, three
settings has to be changed:</p>
<ol class="arabic simple">
<li>Project-&gt;Options-&gt;General Options-&gt;Target-&gt;Device</li>
<li>Project-&gt;Options-&gt;C/C++ Compiler-&gt;Preprocessor-&gt;Defined symbols (consult device.h for appropriate value)</li>
<li>Project-&gt;Options-&gt;Assembler-&gt;Preprocessor-&gt;Defined symbols (consult device.h for appropriate value)</li>
</ol>
<p>If  user want to use his own build system <a class="footnote-reference" href="#id4" id="id2" name="id2">[2]</a> he has to specify the following
command-line options for various tools:</p>
<div class="section">
<h2><a class="toc-backref" href="#id13" id="assembler" name="assembler">Assembler:</a></h2>
<pre class="literal-block">
-DAT91SAM7S64
--cpu ARM7TDMI
--fpu None
-r
-OObj
-LList
-ISrc
-I..\scmRTOS\Common
-I..\scmRTOS\ARM7
-I$TOOLKIT_PATH$\arm\INC
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id14" id="compiler" name="compiler">Compiler:</a></h2>
<pre class="literal-block">
-e
--eec++
-s9
-DAT91SAM7S64
-lCN List
-o Obj
--debug
--cpu_mode thumb
--endian little
--cpu ARM7TDMI-S
--stack_align 4
--interwork
--fpu None
--dlib_config $TOOLKIT_PATH$\arm\LIB\dl4tptinl8n.h
-ISrc
-I$TOOLKIT_PATH$\arm\INC\
-I../scmRTOS/Common
-I../scmRTOS/ARM7
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id15" id="linker" name="linker">Linker:</a></h2>
<pre class="literal-block">
-s __program_start
-r
-xmseo
dl4tptinl8n.r79
-o Exe\slon.d79
-l List\slon.map
-I $TOOLKIT_PATH$\arm\LIB
-f Config\AT91SAM7_FLASH.xcl (or -f Config\AT91SAM7_RAM.xcl)
-Osimple-code=Exe\slon.sim
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">where <tt class="docutils literal"><span class="pre">$TOOLKIT_PATH$</span></tt> - path to folder with toolkit installed.</p>
</div>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="id3">[1]</a></td><td>For more details about <tt class="docutils literal"><span class="pre">svn:externals</span></tt> see <a class="reference" href="http://subversion.tigris.org">Subversion</a> documentation.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2" name="id4">[2]</a></td><td>For example, make or simple bat file.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
