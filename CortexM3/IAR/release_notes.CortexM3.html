<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>scmRTOS v3 Cortex-M3/IARARM Release Notes</title>
<meta name="author" content="Harry E.Zhurov, Andrey Chuikin" />
<meta name="date" content="$Date $" />
<style type="text/css">

body {
   background-color: #E5EDFF;
   color: #000;
   font-family: Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   margin: 0px;
}

br {
   background-color: Aqua;
}
/*
from docutils
.borderless, table.borderless td, table.borderless th {
  border: 0 }
*/
.borderless, table.borderless td, table.borderless th 
{
  border: 0 
}
  

div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 7px; 
  width: 33%;
  background-color: #E9E9E9;
/*  font: "Times New Roman", Times, serif;
  font-size: 20%;
  */
  }


a {
   text-decoration: none;
   color: #4169E1;
}

table.a {
   text-decoration: none;
   color: #4169E1;
}

a:hover {
   text-decoration: underline;
/*   color: #25B026;*/
/*   background-color: #DEB887; */
}

a:visited {
   color: #8B008B; /* #4169E1;   */
}

table {
   clear: both;
   background-color: #E5EDFF;
   color: #000;
   font-family: "Trebuchet MS", Georgia, System, Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
/*   font-weight: bold; */
}

table.filelist {
   clear: both;
   background-color: #FFFEF6;
   color: #000;
   font-family: "Trebuchet MS", Georgia, System, Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   width: 70%;
}

table.targetlist {
   clear: both;
   color: #000;
   font-family: "Trebuchet MS", Georgia, System, Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   width: 50%;
}

table.marklist {
   clear: both;
   color: #000;
   font-family: "Trebuchet MS", Georgia, System, Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   width: 35%;
}

.marklist {
   clear: both;
   color: #000;
   font-family: "Trebuchet MS", Georgia, System, Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   width: 60%;
}


li {
   font-family: Garamond, sans-serif;
   font-size: small;
   font-weight: normal;
   color: Black;
}

ul.plain li {
   font-family: Arial, Garamond, sans-serif;
   font-size: 100%;
   font-weight: normal;
   color: Black;
   list-style: disc;
   width: 70%;
   line-height: 120%;
   text-decoration: none;
   text-align: justify;
   padding-bottom: 6px;
}

ul.plain2 li {
   font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
   font-size: 90%;
   font-weight: normal;
   color: Black;
   list-style: square;
   width: 70%;
   line-height: 120%;
   text-decoration: none;
   text-align: justify;
   padding-top: 3px;
/*   padding-bottom: 6px; */
}

ul.plain3 li {
   font-family: Arial, Garamond, sans-serif;
   font-size: 100%;
   font-weight: normal;
   color: Black;
   list-style: square;
   width: 50%;
   line-height: 120%;
   text-decoration: none;
   text-align: justify;
   padding-bottom: 6px;
}


ul.numeric li {
   font-family: Arial, Garamond, sans-serif;
   font-size: 100%;
   font-weight: normal;
   color: Black;
   list-style: decimal;
   width: 70%;
   line-height: 120%;
   text-decoration: none;
   text-align: justify;
   border: solid;
   border-style: none;
   padding-bottom: 6px;
}

h3 {
   color: #8A2256;
   font-size: 120%;   
}
h4 {
   color: #8A2256;
   font-size: 100%;   
}
h5 {
   color: #8A2256;
   font-size: 90%;   
}
h6 {
   color: #8A2256;
   font-size: 80%;
   font-style: italic;
}

#banner td {
   background-color: #0A275A;
/*   color: #F5DEB3;*/
   color: #F0E68C;
   font-family: Tahoma, "Trebuchet MS", sans-serif;
   padding: 4px;
}
#banner h1 {
   color: #F0E68C;
   display: inline;
   font-family: Tahoma, "Trebuchet MS", sans-serif;
   font-size: 14pt;
   /*font-weight: bold;*/
}

#banner h11 {
   color: #F0E68C;
   display: inline;
   font-family: Tahoma, "Trebuchet MS", sans-serif;
   font-size: 14pt;
   font-weight: bold;
}


#subtitle {
   text-indent: 10ex;
   font-size: 19pt;
   /*font-style: italic;*/
   font-weight: bold;
}
#menu td {
   background-color: #228B22;
   color: #E0FFFF;   
   font-size: 80%;
   padding-left: 8px;
   padding-right: 8px;
}
#menu td.topmenu {
   background-color: #E0FFFF;
/*   background-color: #DEB887;*/
   color: #0000CD;
   border: 1px solid #228B22;
   font-style: italic;
}
a.amenu {
   background-color: #6495ED;
   color: #E0FFFF;
}
a.amenu:hover {
/*   background-color: #228B22; */
   background-color: #191970;
   color: #fff;
   text-decoration: underline;
}
a.amenu:visited {
   color: #708090;   
}
#footer {
   background-color: #0A275A;
   color: #F0E68C;
   font-size: 80%;   
}
#breadcrumbs {
   font: sans-serif;
   font-size: 80%;
   font-weight: bold;
   padding: 1ex;
   margin-bottom: 1ex;
   margin-top: 2px;
   border-bottom: 1px solid #A9A9A9;
}
#breadcrumbs a {
   color: #00008B;   
}
#main {
   border-left: 1px solid #A9A9A9;
}
#text {
   font-size: 95%;
   padding-left: 8px;
   padding-bottom: 1em;
   padding-right: 1em;
}
#text p {
   text-align: justify;
/* disabled for compatibility with Makehtml.py v.1.3
   text-indent: 2em; */
}

/* 2004-09-10 bialix */
#text div.document p {
   text-indent: 0;
}
th.field-name {
   text-align: left;
   padding-left: 6px;
   padding-right: 1em;
}
/* end 2004-09-10 bialix */

div.attention
{
/*  color: red ;*/
  font-weight: bold ;
  font-family: sans-serif;

  margin: 2em ;
  border: medium outset ;
  padding: 1em }

blockquote.epigraph {
  font-style: italic;
  font-size: 85%;
  font-family: sans-serif;

  margin-right: 2em;
  border: medium outset;
  padding: 1em;
  width: 30%;
  float: right;
}

/* 2005-05-02 bialix */
div.menu {
   margin: 5px; 
   width: 10ex;
}

div.menu p {
   display: block; 
   border: 1px solid #228B22; 
   padding: 4px 8px;
   margin: 0;
   font-size: 80%;
   font-style: italic;
   color: #228B22;
}

div.menu ul {
   display: block; 
   margin: 0; 
   padding: 0;
}

div.menu li {
   display: block; 
   border: 1px solid #A9A9A9;
   padding: 3px 8px;
   margin-top: 5px;
   font-size: 80%;
   background-color: #228B22;
   color: #A9A9A9;
}

/* 2005-07-12 for compatibility with IE6 must be a.reference */
div.menu a.reference {
   background-color: #228B22;
   color: #A9A9A9;
}

/* end  2005-05-02 bialix */

/* 2005-07-14 bialix */
td.menu2 {
   width: 13%;
}
.gridmenu td {
   background-color: #495C61; /* #7A8D96 */
   color: #FAFAD2;   
/*   font-family:  Tahoma, Geneva, Arial, Helvetica, sans-serif; */
   font-weight: bold;
   font-size: 80%;
   padding-left: 8px;
   padding-right: 8px;
}

.gridmenu th {
   border: 1px solid #DCDCDC;
   color: #00008B;
   font-family:  Tahoma, Geneva, Arial, Helvetica, sans-serif;
   font-size: 90%;
   padding-left: 8px;
   padding-right: 8px;
   text-align: left;
}

.gridmenu a.reference {
   background-color: #495C61;
   color: #87CEEB; /* #00FF02 */
   font-family:  Tahoma, Geneva, Arial, Helvetica, sans-serif;
   font-weight: bold;
}
.gridmenu a.reference:hover {
   background-color: #495C61; /* #BBB8E2 */
   color: #DAA520;
   text-decoration: underline;
}
.gridmenu a.reference:visited {
   background-color: #495C61;
   color: #DBA083;   
}

/* end 2005-07-14 bialix */



/**********************************************************/

pre {
   background-color: #D4D8DE;
}

li {
   font-family: sans-serif;
   font-size: small;
   font-weight: normal;
   color: Black;
}



tr {
   text-align: left;
}


h1.title {
   text-align: center;
   background-color: #123676;
   color: #D2C01A;
   font-family: Tahoma, sans-serif;
   font-weight: bold;
   font-size: 24px;
  }


h1 {
   background-color: #AEC8F6;
   border: none;
   font-family: Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   font-size: 20px;
}

h11 {
/*   background-color: #AEC8F6; */
   border: none;
   font-family: Verdana, Tahoma, Geneva, Arial, Helvetica, sans-serif;
   font-weight: bold;
   font-size: 20px; 
}
   
   
h2 {
   font-family: Verdana, Tahoma, sans-serif;
   font-size: 16px;
   padding-top: 12px;
}

a {
   color: #232791;
}

A:visited {
   color: #8B008B; /* #4169E1;   */
}

p {
   font-family: Garamond, System, Verdana, Tahoma, sans-serif;
   font-size: 130%;
   font-weight: normal;
   color: Black;
}

.contents {
   font-family: Arial, sans-serif;
   font-weight: bolder;
   font-size: medium;
}






</style>
</head>
<body>
<div class="document" id="scmrtos-v3-Cortex-M3-IARARM-release-notes">
<h1 class="title">scmRTOS v3 Cortex-M3/IARARM Release Notes</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Harry E.Zhurov, Andrey Chuikin</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>$Date $</td></tr>
<tr><th class="docinfo-name">Revision:</th>
<td>$Rev $</td></tr>
<tr class="field"><th class="docinfo-name">Info:</th><td class="field-body">See main scmRTOS User's Manual for details</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">contents</a></p>
<ul class="simple">
<li><a class="reference" href="#preamble" id="id7" name="id7">Preamble</a></li>
<li><a class="reference" href="#general-description" id="id8" name="id8">General Description</a></li>
<li><a class="reference" href="#sample-structure" id="id9" name="id9">Sample Structure</a></li>
<li><a class="reference" href="#usage" id="id10" name="id10">Usage</a><ul>
<li><a class="reference" href="#working-with-repository" id="id11" name="id11">Working with Repository</a></li>
<li><a class="reference" href="#working-with-release" id="id12" name="id12">Working with Release</a></li>
<li><a class="reference" href="#standalone-rtos-sources" id="id13" name="id13">Standalone RTOS sources</a></li>
</ul>
</li>
<li><a class="reference" href="#building" id="id14" name="id14">Building</a><ul>
<li><a class="reference" href="#assembler" id="id15" name="id15">Assembler:</a></li>
<li><a class="reference" href="#compiler" id="id16" name="id16">Compiler:</a></li>
<li><a class="reference" href="#linker" id="id17" name="id17">Linker:</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id7" id="preamble" name="preamble">Preamble</a></h1>
<p>Release includes a sample set that contains three samples and RTOS sources.
The purpose of the sample set is to show use examples and primary RTOS
functionality and features.</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id8" id="general-description" name="general-description">General Description</a></h1>
<p>RTOS consists of three parts:</p>
<ul class="simple">
<li>Common part;</li>
<li>Target-dependent part;</li>
<li>Project-dependent part.</li>
</ul>
<p>Common part contains main RTOS definitions and declarations such as RTOS kernel,
interprocess communication services and little support library. All Common sources
stand at <tt class="docutils literal"><span class="pre">Common</span></tt> subfolder (see below).</p>
<p>Target-dependent part describes target processor and toolkit features of the RTOS:</p>
<ul class="simple">
<li>Target-level configuration macros;</li>
<li>Critical section definition;</li>
<li>Some performance-critical functions;</li>
<li>Interrupt and interrupt service routines support;</li>
<li>Target processor specific process's constructor;</li>
<li>Idle process declaration.</li>
</ul>
<p>Project-dependent part includes two header files:</p>
<ul class="simple">
<li>scmRTOS_CONFIG.h;</li>
<li>scmRTOS_TARGET_CFG.h.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">scmRTOS_CONFIG.h</span></tt> describes project-level RTOS configuration macros.</p>
<p><tt class="docutils literal"><span class="pre">scmRTOS_TARGET_CFG.h</span></tt> contains project-level tuning code, in particular
System Timer and context switch software interrupt stuff. Default, System tick timer
is used as OS System Timer, and PendSV interrupt as Software Context
Switch Interrupt.
<p>Cortex-M3 port features.
<ul class="simple">
<li>Only "Software interrupt program control flow transfer" is used. "Direct program control flow transfer" is not implemented.</li>
<li>System tick timer is used as the OS SystemTimer.</li>
<li>All settings of the System Timer are done by the OS except timer clock frequency. Timer clock frequency and timer's interrupt rate must be set up by the user (with macros SYSTICKFREQ, SYSTICKINTRATE in scmRTOS_TARGET_CFG.h).</li>
<li>Macro ENABLE_NESTED_INTERRUPTS is empty because hardware implementation of nested interrupts. In addition macro DISABLE_NESTED_INTERRUPTS is implemented for global disable nested interrupts.</li>
<li>Interrupts use stack defined in *.icf file (CSTACK).</li>
<li>The most effective context switch takes place when scmRTOS_PRIORITY_ORDER==1.</li>
<li>Interrupts utilize Main_stack. Main program (tasks) utilize Process_stack.</li>
</ul>
</p>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id9" id="sample-structure" name="sample-structure">Sample Structure</a></h1>
<p>The sample consists of three parts:</p>
<ul class="simple">
<li>EventFlag.</li>
<li>message.</li>
<li>channel.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">EventFlag</span></tt> sample brings test on speed. <tt class="docutils literal"><span class="pre">OS::TEventFlag</span></tt>  is the simplest and
fastest   service   of   the   RTOS.   In  this  example  program  control  flow
transferred  from   <tt class="docutils literal"><span class="pre">OS::SystemTimerUserHook</span></tt>   to   waiting
process.</p>
<p><tt class="docutils literal"><span class="pre">OS::message</span></tt> sample demonstrates ability to send arbitrary information from ISRs
and  processes  to  processes.  In the example one process waits the message and
timer  ISR and another process send the message. Message content is different in
each case, so, process-receiver can distinguish the source of the message.</p>
<p>Sample  with  <tt class="docutils literal"><span class="pre">OS::channel</span></tt>  shows  a  message  queue. Since the message can have
arbitrary type, current example uses pointers to class types. In the example two
more  priority  processes  &quot;delegate&quot;  some  actions to the third (low-priority)
process. See scmRTOS User's Manual Appendix section for more details about this
mechanism.</p>
<p>Contents  of  all parts is the same: test project and RTOS sources. Each located
in its own folder.</p>
<p>Structure of test project folder (folders are in brackets '[]'):</p>
<pre class="literal-block">
[Debug/Exe]       - executable product[s]
[Debug/List]      - listings and other temporary text files
[Debug/Obj]       - objects and other intermediate files
[settings]        - IAR IDE auxiliary files
[Src]             - test project sources
slon.ewd          - IAR IDE auxiliary file
slon.ewp          - IAR IDE project
slon.eww          - IAR IDE workspace
</pre>
<p><strong>slon</strong> is test project name.</p>
<p>Structure of the RTOS folder:</p>
<pre class="literal-block">
scmRTOS
  Common            - common RTOS sources
  CortexM3          - portable part
</pre>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id10" id="usage" name="usage">Usage</a></h1>
<p>There are two variants of usage. The first variant is checking out sample set from the
<a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">SourceForge repository</a>. The second one is downloading the release archive and using it locally.</p>
<div class="section">
<h2><a class="toc-backref" href="#id11" id="working-with-repository" name="working-with-repository">Working with Repository</a></h2>
<p>Initially, after checkout from repository the folders</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/Common</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/CortexM3</span></tt></div>
</div>
<p>are  empty. User has to switch these folders manually to appropriate repository
folders:</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/Common</span> <span class="pre">to</span> <span class="pre">$REP$/Common</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">scmRTOS/CortexM3</span> <span class="pre">to</span> <span class="pre">$REP$/Ports/CortexM3/IAR</span></tt></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">$REP$</span></tt> is proper branch of the repository.</p>
<p>After this working copy is ready to build.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id12" id="working-with-release" name="working-with-release">Working with Release</a></h2>
<p>In  this  case  no  extra  actions  required. User can build the samples at this
point.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id13" id="standalone-rtos-sources" name="standalone-rtos-sources">Standalone RTOS sources</a></h2>
<p>There is one more way to usage RTOS (RTOS only, not the whole release). To do this
the user has to create local folders for RTOS sources - for Common part and for Port
part as well. For example, create at user's project folder subfolder <tt class="docutils literal"><span class="pre">scmRTOS</span></tt> (or
with any other suitable name); inside this subfolder create subfolders for Common
and Port sources; set to this subfolders <tt class="docutils literal"><span class="pre">svn:externals</span></tt> <a class="footnote-reference" href="#id4" id="id1" name="id1">[1]</a> properties that will link
these subfolders to the appropriate folders in <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">external (SourceForge) repository</a>.</p>
<p>In this way, user gets the ability to synchronize its project RTOS sources with <a class="reference" href="https://scmrtos.svn.sourceforge.net/svnroot/scmrtos">main
RTOS repository</a>.</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="toc-backref" href="#id14" id="building" name="building">Building</a></h1>
<p>There is only one way to build any sample provided - <strong>IAR IDE</strong>.</p>
<p>Just launch IDE, open appropriate workspace (*.eww file) and execute RebuildAll command.</p>
<p>If  user want to use his own build system <a class="footnote-reference" href="#id6" id="id3" name="id3">[2]</a> he has to specify the following
command-line options for various tools:</p>
<div class="section">
<h2><a class="toc-backref" href="#id13" id="assembler" name="assembler">Assembler:</a></h2>
<pre class="literal-block">
-STM32F10xxB  (or another suitable Cortex-M3 chip type)
--cpu Cortex-M3
--fpu None
-r
-O$PROJ_DIR$\Debug\Obj
-L$PROJ_DIR$\Debug\List
-I$PROJ_DIR$\Src
-I$PROJ_DIR$\..\scmRTOS\Common
-I$PROJ_DIR$\..\scmRTOS\CortexM3
-I$TOOLKIT_PATH$\arm\INC
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id14" id="compiler" name="compiler">Compiler:</a></h2>
<pre class="literal-block">
-e
--eec++
-STM32F10xxB  (or another suitable Cortex-M3 chip type)
-lCN$PROJ_DIR$\Debug\List
-o$PROJ_DIR$\Debug\Obj
--debug
--endian little
--cpu Cortex-M3
--cpu_mode thumb
--stack_align 4
--fpu None
--dlib_config $TOOLKIT_PATH$\arm\INC\DLib_Config_Normal.h
-I$PROJ_DIR$\Src
-I$TOOLKIT_PATH$\arm\INC\
-I$PROJ_DIR$\..\scmRTOS\Common
-I$PROJ_DIR$\..\scmRTOS\CortexM3
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id15" id="linker" name="linker">Linker:</a></h2>
<pre class="literal-block">
--config $PROJ_DIR$\src\stm32f10x_flash.icf
--semihosting
--entry __iar_program_start
-o $PROJ_DIR$\Debug\Exe\slon.out
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">where <tt class="docutils literal"><span class="pre">$TOOLKIT_PATH$</span></tt> - path to folder with toolkit installed and <tt class="docutils literal"><span class="pre">$PROJ_DIR$</span></tt> - path to folder with project.</p>
</div>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="id4">[1]</a></td><td>For more details about <tt class="docutils literal"><span class="pre">svn:externals</span></tt> see <a class="reference" href="http://subversion.tigris.org">Subversion</a> documentation.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3" name="id6">[2]</a></td><td>For example, make or simple bat file.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>